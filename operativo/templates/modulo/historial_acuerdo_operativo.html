{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Historial de Acuerdos Operativos</title>
    <link rel="stylesheet" href="{% static 'css/historial.css' %}">
    <style>
        input[type="text"], input[type="number"], textarea { width: 100%; }
        form { margin: 0; }
        td { vertical-align: top; }
        .acciones form { display: inline; }
        .acciones button { margin-right: 5px; }
    </style>
</head>
<body>
    <h1>Historial de Acuerdos Operativos</h1>

    <!-- Barra de búsqueda -->
    <form method="get" action="">
        <input type="text" name="q" placeholder="Buscar..." value="{{ query|default:'' }}">
        <button type="submit">Buscar</button>
        {% if query %}
            <a href="{% url 'historial_acuerdo_operativo' %}">Limpiar</a>
        {% endif %}
    </form>

    <!-- Tabla de resultados -->
    <table border="1" cellpadding="5" cellspacing="0">
        <thead>
            <tr>
                <th>Número</th>
                <th>Unidad</th>
                <th>Acuerdo</th>
                <th>Unidad Parada</th>
                <th>Fecha Límite</th>
                <th>Pendiente</th>
                <th>Responsable</th>
                <th>Avance (%)</th>
                <th>Comentario</th>
                <th>Acciones</th>
                <th>Eliminar datos</th>
                <th>Fecha de Creación</th>
            </tr>
        </thead>
        <tbody>
            {% for acuerdo in acuerdos %}
            <tr>
                <!-- Número y Unidad (solo mostrar, no editar) -->
                <td>{{ acuerdo.numerador }}</td>
                <td>{{ acuerdo.unidad }}</td>

                <!-- Formulario de edición dentro de los campos editables -->
                <form method="post" action="{% url 'editar_acuerdo_operativo' acuerdo.id %}">
                    {% csrf_token %}
                    <td>
                        <textarea name="acuerdo">{{ acuerdo.acuerdo }}</textarea>
                    </td>
                    <td>
                        <input type="checkbox" name="unidad_parada" {% if acuerdo.unidad_parada %}checked{% endif %}>
                    </td>
                    <td>{{ acuerdo.fecha_limite|date:"d/m/Y" }}</td>
                    <td>{% if acuerdo.pendiente %} Sí {% else %} No {% endif %}</td>
                    <td>{{ acuerdo.responsable.nombre_completo }}</td>
                    <td>
                        <input type="number" name="porcentaje_avance" value="{{ acuerdo.porcentaje_avance }}" min="0" max="100"
                            class="
                            {% if acuerdo.porcentaje_avance < 90 %}
                                avance-rojo
                            {% elif acuerdo.porcentaje_avance < 100 %}
                                avance-amarillo
                            {% else %}
                                avance-verde
                            {% endif %}
                            ">
                    </td>
                    <td>
                        <textarea name="comentario">{% if acuerdo.comentario %}{{ acuerdo.comentario.texto }}{% endif %}</textarea>
                    </td>
                    <td class="acciones">
                        <button type="submit">Guardar</button>
                    </td>
                </form>

                <!-- Botón de eliminar separado -->
                <td class="acciones">
                    <form method="post" action="{% url 'eliminar_acuerdo_operativo' acuerdo.id %}" onsubmit="return confirm('¿Deseas eliminar este acuerdo?')">
                        {% csrf_token %}
                        <button type="submit">Eliminar</button>
                    </form>
                </td>

                <!-- Fecha de creación -->
                <td>{{ acuerdo.fecha_creacion|date:"d/m/Y H:i" }}</td>
            </tr>
            {% empty %}
                <tr>
                    <td colspan="12">No hay acuerdos registrados.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <br>
    <a href="{% url 'crear_acuerdo_operativo' %}">← Volver a crear acuerdos</a>
</body>
</html>
